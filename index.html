<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcona Roofing Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; min-height: 100vh; padding: 24px; color: #0f172a; }
        .dashboard-container { max-width: 1600px; margin: 0 auto; }
        .header { background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%); padding: 24px; border-radius: 16px; margin-bottom: 24px; box-shadow: 0 10px 30px rgba(2,6,23,0.15); }
        .header h1 { color: #0f172a; font-size: 2.4rem; margin-bottom: 8px; letter-spacing: 0.2px; }
        .header p { color: #475569; }
        .user-toggle { display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap; }
        .user-btn { padding: 12px 18px; font-size: 1.05rem; border: 2px solid transparent; border-radius: 10px; cursor: pointer; transition: all .2s ease; font-weight: 700; background: #e2e8f0; color: #334155; }
        .user-btn.active { background: #4f46e5; color: #ffffff; box-shadow: 0 8px 18px rgba(79,70,229,0.25); }
        .grid-layout { display: grid; grid-template-columns: repeat(12, 1fr); gap: 24px; margin-bottom: 24px; }
        .card { background: #ffffff; border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(2,6,23,0.15); }
        .card h2 { color: #1e293b; font-size: 1.4rem; margin-bottom: 16px; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .calendar-section { grid-column: span 12; }
        .materials-section { grid-column: span 6; }
        .notes-section { grid-column: span 6; }
        @media (max-width: 1100px) { .materials-section, .notes-section { grid-column: span 12; } }
        .job-entry { background: #f8fafc; padding: 14px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #e2e8f0; display: grid; grid-template-columns: 2fr 1.4fr 1fr 1fr; gap: 10px; }
        .job-entry textarea { grid-column: 1 / -1; }
        .job-entry input, .job-entry textarea, .material-item input, .notes-area { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1.05rem; font-family: inherit; background: #ffffff; color: #0f172a; }
        .job-entry input:focus, .job-entry textarea:focus, .material-item input:focus, .notes-area:focus { outline: none; border-color: #4f46e5; box-shadow: 0 0 0 4px rgba(79,70,229,0.15); }
        .material-item { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; margin-bottom: 12px; padding: 12px; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0; }
        .notes-area { min-height: 260px; resize: vertical; }
        .add-btn, .save-btn { background: #4f46e5; color: white; border: none; padding: 14px 18px; border-radius: 10px; font-size: 1.05rem; cursor: pointer; margin-top: 10px; font-weight: 700; transition: background .2s ease, transform .1s ease; }
        .add-btn:hover, .save-btn:hover { background: #4338ca; }
        .add-btn:active, .save-btn:active { transform: translateY(1px); }
        .toolbar { display: flex; gap: 12px; flex-wrap: wrap; }
        .date-header { font-size: 1.15rem; color: #334155; margin-bottom: 12px; font-weight: 700; }
        .save-indicator { position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 14px 18px; border-radius: 10px; display: none; font-weight: 800; box-shadow: 0 10px 30px rgba(16,185,129,0.25); }
        .wall-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .badge { padding: 6px 10px; border-radius: 999px; font-size: .85rem; background: #e2e8f0; color: #334155; font-weight: 700; }
    </style>
</head>
<body>
    <div class="save-indicator" id="saveIndicator">Changes Saved</div>
    <div class="dashboard-container">
        <div class="header">
            <h1>Transcona Roofing Dashboard</h1>
            <p>Daily Operations & Job Tracking</p>
            <div class="user-toggle">
                <button class="user-btn active" onclick="switchUser('foreman')" id="foremanBtn">üë∑ Foreman View</button>
                <button class="user-btn" onclick="switchUser('operator')" id="operatorBtn">üîß Service Operator</button>
                <div class="badge" id="activeUserBadge">Active: Foreman</div>
            </div>
        </div>
        <div class="grid-layout">
            <div class="card calendar-section">
                <h2>üìÖ Job Log & Calendar</h2>
                <div class="toolbar">
                    <div class="date-header" id="currentDate"></div>
                    <button class="save-btn" onclick="addJob()">+ Add Job</button>
                    <button class="save-btn" onclick="clearJobs()">Clear Jobs</button>
                </div>
                <div id="jobsList"></div>
            </div>
            <div class="card materials-section">
                <h2>üì¶ Materials Tracker</h2>
                <div class="toolbar">
                    <button class="save-btn" onclick="addMaterial()">+ Add Material</button>
                    <button class="save-btn" onclick="clearMaterials()">Clear Materials</button>
                </div>
                <div id="materialsList"></div>
            </div>
            <div class="card notes-section">
                <h2>üìù Daily Notes & Feedback</h2>
                <textarea class="notes-area" id="dailyNotes" placeholder="Enter daily notes, feedback, issues, or observations here..." onchange="saveData()"></textarea>
                <div style="margin-top: 12px; color: #64748b;">
                    <strong>Quick Tips:</strong>
                    <ul style="margin-left: 20px; margin-top: 8px; line-height: 1.7;">
                        <li>Document any safety concerns</li>
                        <li>Note weather conditions</li>
                        <li>Record equipment issues</li>
                        <li>Log customer feedback</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = 'foreman';

        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

        function switchUser(user) {
            currentUser = user;
            document.getElementById('foremanBtn').classList.toggle('active', user === 'foreman');
            document.getElementById('operatorBtn').classList.toggle('active', user === 'operator');
            document.getElementById('activeUserBadge').textContent = `Active: ${user === 'foreman' ? 'Foreman' : 'Service Operator'}`;
            loadData();
        }

        function addJob(prefill = {}) {
            const jobsList = document.getElementById('jobsList');
            const newJob = document.createElement('div');
            newJob.className = 'job-entry';
            newJob.innerHTML = `
                <input type="text" placeholder="Job Address" class="job-address" value="${prefill.address || ''}" onchange="saveData()">
                <input type="text" placeholder="Client Name" class="job-client" value="${prefill.client || ''}" onchange="saveData()">
                <input type="date" class="job-date" value="${prefill.date || ''}" onchange="saveData()">
                <input type="time" class="job-time" value="${prefill.time || ''}" onchange="saveData()">
                <textarea placeholder="Job Details & Status" rows="2" class="job-details" onchange="saveData()">${prefill.details || ''}</textarea>
            `;
            jobsList.appendChild(newJob);
            saveData();
        }

        function addMaterial(prefill = {}) {
            const materialsList = document.getElementById('materialsList');
            const newMaterial = document.createElement('div');
            newMaterial.className = 'material-item';
            newMaterial.innerHTML = `
                <input type="text" placeholder="Material Name" class="material-name" value="${prefill.name || ''}" onchange="saveData()">
                <input type="number" placeholder="Quantity" class="material-qty" value="${prefill.quantity || ''}" onchange="saveData()">
                <input type="text" placeholder="Location" class="material-location" value="${prefill.location || ''}" onchange="saveData()">
            `;
            materialsList.appendChild(newMaterial);
            saveData();
        }

        function clearJobs() {
            document.getElementById('jobsList').innerHTML = '';
            saveData();
        }

        function clearMaterials() {
            document.getElementById('materialsList').innerHTML = '';
            saveData();
        }

        function saveData() {
            const data = { jobs: [], materials: [], notes: document.getElementById('dailyNotes').value };

            document.querySelectorAll('.job-entry').forEach(entry => {
                data.jobs.push({
                    address: entry.querySelector('.job-address').value,
                    client: entry.querySelector('.job-client').value,
                    date: entry.querySelector('.job-date').value,
                    time: entry.querySelector('.job-time').value,
                    details: entry.querySelector('.job-details').value
                });
            });

            document.querySelectorAll('.material-item').forEach(item => {
                data.materials.push({
                    name: item.querySelector('.material-name').value,
                    quantity: item.querySelector('.material-qty').value,
                    location: item.querySelector('.material-location').value
                });
            });

            localStorage.setItem(`dashboard_${currentUser}`, JSON.stringify(data));
            showSaveIndicator();
        }

        function loadData() {
            const savedData = localStorage.getItem(`dashboard_${currentUser}`);
            document.getElementById('jobsList').innerHTML = '';
            document.getElementById('materialsList').innerHTML = '';
            document.getElementById('dailyNotes').value = '';

            if (!savedData) { addJob(); addMaterial(); return; }
            const data = JSON.parse(savedData);

            (data.jobs || []).forEach(job => addJob(job));
            (data.materials || []).forEach(mat => addMaterial(mat));
            document.getElementById('dailyNotes').value = data.notes || '';
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.style.display = 'block';
            setTimeout(() => { indicator.style.display = 'none'; }, 1200);
        }

        loadData();
    </script>
</body>
</html>
